#!/bin/bash
# RG-AIO Terminal Panel Menu - Rahamat Gazi (RG)

clear
# Colors
y='\e[1;33m' # Yellow
g='\e[1;32m' # Green
b='\e[1;34m' # Blue
r='\e[1;31m' # Red
c='\e[0m'    # Reset

# System Info
HOSTNAME=$(hostname)
IPV4=$(curl -s ipv4.icanhazip.com)
DOMAIN=$(cat /etc/xray/domain 2>/dev/null || echo "Not set")
ISP=$(curl -s ipinfo.io/org | cut -d " " -f2-)
RAM_TOTAL=$(free -m | awk 'NR==2 {print $2}')
RAM_USED=$(free -m | awk 'NR==2 {print $3}')
CPU_LOAD=$(top -bn1 | grep "load average" | awk '{print $12}' | sed 's/,//')
CORES=$(nproc)
OS=$(lsb_release -d | cut -f2-)
DATE=$(date +%d/%m/%Y)
TIME=$(date +%T)

# Header
echo -e "${g}╔════════════════════════════════════╗"
echo -e "║      🛡️  SCRIPT RG-AIO by RG        ║"
echo -e "╚════════════════════════════════════╝${c}"
echo -e "${b}┌──────────── SYSTEM INFO ─────────────┐${c}"
echo -e "${y} Hostname     : $HOSTNAME"
echo -e " Public IP    : $IPV4"
echo -e " Domain       : $DOMAIN"
echo -e " ISP          : $ISP"
echo -e " RAM          : $RAM_USED / $RAM_TOTAL MB"
echo -e " CPU Cores    : $CORES"
echo -e " Load Average : $CPU_LOAD"
echo -e " OS           : $OS"
echo -e " Date         : $DATE"
echo -e " Time         : $TIME${c}"
echo -e "${b}└─────────────────────────────────────┘${c}"

# Service Status (Static Example)
echo -e "${g} SSH       : ON  ${c}|${g}  Dropbear : ON  ${c}|${g} SSH-WS : ON ${c}"
echo -e "${g} NGINX     : ON  ${c}|${g}  STUNNEL  : ON  ${c}|${g} XRAY   : ON ${c}"
echo ""

# Menu Options
echo -e "${b}┌────────────── RG-AIO MENU ──────────────┐${c}"
echo -e "${y} [01] SSH / WebSocket"
echo -e " [02] VMESS"
echo -e " [03] DOMAIN"
echo -e " [04] REBOOT VPS"
echo -e " [05] INFO PORT"
echo -e " [06] BACKUP"
echo -e " [07] RAM & CPU USAGE"
echo -e " [08] SYSTEM INFO"
echo -e " [09] MENU SYSTEM"
echo -e " [10] EXIT${c}"
echo -e "${b}└────────────────────────────────────────┘${c}"
echo -ne "${y}Select ➤ ${c}"; read opt

case $opt in
  1)
    echo -e "${g}🔐 SSH/WebSocket Menu:"
    echo "1. Add User"
    echo "2. Delete User"
    echo "3. Check Login"
    echo -ne "Choose ➤ "; read sopt
    case $sopt in
      1) read -p "Username: " u && read -p "Password: " p && useradd -M -s /bin/false $u && echo "$u:$p" | chpasswd && echo "✅ User $u created" ;;
      2) read -p "Username to delete: " u && userdel $u && echo "✅ User $u deleted" ;;
      3) echo -e "📋 Active SSH Users:" && who ;;
      *) echo "Invalid option." ;;
    esac ;;
  2)
    echo -e "${r}🔧 VMESS panel coming soon in RG-AIO Pro 🔥${c}" ;;
  3)
    echo -e "🌐 Domain Configuration:"
    read -p "Enter new domain: " NEWDOMAIN
    echo "$NEWDOMAIN" > /etc/xray/domain
    echo "✅ Domain updated to $NEWDOMAIN" ;;
  4)
    echo "♻️ Rebooting VPS..." && sleep 2 && reboot ;;
  5)
    echo "📊 Listening Ports:"
    ss -tuln ;;
  6)
    echo "📦 Creating backup..."
    mkdir -p /root/rg-backup
    cp /etc/xray/domain /root/rg-backup/domain.txt 2>/dev/null
    cp /etc/ssl/rg/* /root/rg-backup/ 2>/dev/null
    tar -czf /root/rg-backup.tar.gz /root/rg-backup
    echo "✅ Backup saved to /root/rg-backup.tar.gz" ;;
  7)
    echo "📈 RAM and CPU usage:"
    free -h
    top -b -n1 | head -20 ;;
  8)
    echo "🖥 System Info:"
    neofetch || hostnamectl ;;
  9)
    bash /usr/bin/menu ;;
  10)
    echo "🚪 Exiting..." && exit ;;
  *)
    echo "⛔ Invalid option!" ;;
esac
